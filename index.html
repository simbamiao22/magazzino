<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Mappa Magazzino</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      background: #f3f4f6;
      color: #111827;
    }

    header {
      background: #111827;
      color: white;
      padding: 12px 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.25);
    }

    header h1 {
      margin: 0;
      font-size: 20px;
      font-weight: 600;
    }

    /* --- LAYOUT: Mappa sopra, pannello sotto --- */
    main {
      display: flex;
      flex-direction: column;
      gap: 18px;
      padding: 18px;
    }

    .card {
      background: #ffffff;
      border-radius: 12px;
      padding: 18px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.12);
    }

    /* --------------------------------------------- */
    /* üëç LA MAPPA MAGAZZINO NON VIENE TOCCATA QUI   */
    /* --------------------------------------------- */

    .warehouse-wrapper {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .warehouse {
      position: relative;
      width: 1100px;
      height: 430px;
      border: 4px solid #111827;
      background-image: radial-gradient(#e5e7eb 1px, transparent 1px);
      background-size: 16px 16px;
    }

    .warehouse::after {
      content: "";
      position: absolute;
      right: 0;
      bottom: 0;
      width: 120px;
      height: 8px;
      background: #f3f4f6;
    }

    .label-scarico {
      position: absolute;
      left: 950px;
      top: 90px;
      font-size: 18px;
      font-weight: 700;
      color: #111827;
    }

    .label-scarico span { display: block; }

    .label-entrata {
      position: absolute;
      left: 950px;
      bottom: 30px;
      font-size: 18px;
      font-weight: 700;
      color: #111827;
    }

    .shelf {
      position: absolute;
      border: 3px solid #111827;
      background: #fafafa;
      font-weight: 600;
      font-size: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: 0.15s;
    }

    .shelf:hover {
      background: #eef2ff;
      border-color: #6366f1;
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }

    .shelf.active {
      background: #eef2ff;
      border-color: #4f46e5;
    }

    .shelf.highlight {
      background: #ecfdf5;
      border-color: #10b981;
    }

    .shelf-top { top: 60px; height: 80px; width: 90px; }
    .shelf-bottom { bottom: 60px; height: 80px; width: 90px; }

    .s1  { left: 60px; }
    .s2  { left: 170px; }
    .s3  { left: 280px; }
    .s4  { left: 390px; }
    .s5  { left: 500px; }
    .s6  { left: 610px; }
    .s7  { left: 720px; }
    .s8  { left: 830px; }

    .s9  { left: 60px; }
    .s10 { left: 170px; }
    .s11 { left: 280px; }
    .s12 { left: 390px; }
    .s13 { left: 500px; }
    .s14 { left: 610px; }
    .s15 { left: 720px; }
    .s16 { left: 830px; }

    /* --------------------------------------------- */
    /* üé® PANNELLO SOTTO: CONTRASTO + LEGGIBILIT√Ä     */
    /* --------------------------------------------- */

    .panel h2 {
      margin-top: 0;
      font-size: 18px;
      font-weight: 600;
      color: #1f2937;
    }

    .panel small {
      color: #6b7280;
      font-size: 14px;
    }

    .search-box {
      margin-bottom: 12px;
    }

    .search-box label {
      display: block;
      font-size: 14px;
      margin-bottom: 6px;
      font-weight: 600;
      color: #1f2937;
    }

    .search-box input {
      width: 100%;
      padding: 9px 11px;
      border-radius: 8px;
      border: 2px solid #cbd5e1;
      font-size: 15px;
      background: #ffffff;
      color: #111827;
      transition: 0.15s;
    }

    .search-box input:focus {
      border-color: #4f46e5;
      outline: none;
      box-shadow: 0 0 4px rgba(79,70,229,0.5);
    }

    .search-results {
      max-height: 140px;
      overflow-y: auto;
      margin-bottom: 12px;
      border-radius: 8px;
      border: 2px solid #cbd5e1;
      padding: 10px;
      background: #ffffff;
      font-size: 14px;
      color: #1f2937;
    }

    .search-results div {
      margin-bottom: 6px;
    }

    ul {
      list-style: none;
      padding-left: 0;
      margin: 10px 0 0 0;
    }

    li {
      background: #f9fafb;
      border: 1px solid #cbd5e1;
      border-radius: 8px;
      padding: 8px 12px;
      margin-bottom: 8px;
      font-size: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #111827;
    }

    .item-main { flex: 1; }

    li span.qty { font-weight: 700; margin-left: 6px; color: #111827; }

    li small {
      color: #6b7280;
      font-size: 13px;
      margin-left: 6px;
    }

    .btn-small {
      background: #ef4444;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 5px 10px;
      font-size: 13px;
      cursor: pointer;
      transition: 0.15s;
      font-weight: 600;
    }

    .btn-small:hover { background: #dc2626; }

    .empty {
      color: #6b7280;
      font-style: italic;
      margin-top: 10px;
      font-size: 15px;
    }

    .admin-box {
      margin-top: 14px;
      padding-top: 12px;
      border-top: 2px solid #cbd5e1;
    }

    .admin-box h3 {
      margin: 0 0 8px 0;
      font-size: 16px;
      font-weight: 600;
      color: #1f2937;
    }

    .admin-grid {
      display: grid;
      grid-template-columns: 1fr 2fr 1fr;
      gap: 8px;
      margin-bottom: 10px;
    }

    .admin-grid input,
    .admin-grid select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 2px solid #cbd5e1;
      font-size: 14px;
      background: #ffffff;
      color: #111827;
      transition: 0.15s;
    }

    .admin-grid input:focus,
    .admin-grid select:focus {
      border-color: #4f46e5;
      outline: none;
      box-shadow: 0 0 4px rgba(79,70,229,0.5);
    }

    .admin-grid-note input {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 2px solid #cbd5e1;
      font-size: 14px;
      background: #ffffff;
      color: #111827;
    }

    .btn-add {
      background: #4f46e5;
      color: white;
      border: none;
      padding: 10px 14px;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
      font-weight: 600;
      transition: 0.15s;
      margin-top: 4px;
    }

    .btn-add:hover {
      background: #4338ca;
    }

    .admin-box small {
      margin-top: 6px;
      color: #6b7280;
      font-size: 12px;
      line-height: 1.4;
    }
  </style>
</head>
<body>
<header>
  <h1>Mappa magazzino ‚Äì scaffali 1‚Äì16</h1>
</header>

<main>
  <!-- ------------------------------------- -->
  <!--            MAPPA MAGAZZINO            -->
  <!-- ------------------------------------- -->
  <section class="card">
    <h2>Pianta magazzino</h2>
    <small>Clicca su uno scaffale numerato per vedere il contenuto</small>

    <div class="warehouse-wrapper">
      <div class="warehouse">

        <div class="label-scarico">
          <span>ZONA SCARICO</span>
          <span>TEMPORANEO</span>
        </div>

        <div class="label-entrata">ENTRATA</div>

        <!-- Scaffali superiori -->
        <div class="shelf shelf-top s1" data-shelf-id="1">1</div>
        <div class="shelf shelf-top s2" data-shelf-id="2">2</div>
        <div class="shelf shelf-top s3" data-shelf-id="3">3</div>
        <div class="shelf shelf-top s4" data-shelf-id="4">4</div>
        <div class="shelf shelf-top s5" data-shelf-id="5">5</div>
        <div class="shelf shelf-top s6" data-shelf-id="6">6</div>
        <div class="shelf shelf-top s7" data-shelf-id="7">7</div>
        <div class="shelf shelf-top s8" data-shelf-id="8">8</div>

        <!-- Scaffali inferiori -->
        <div class="shelf shelf-bottom s9" data-shelf-id="9">9</div>
        <div class="shelf shelf-bottom s10" data-shelf-id="10">10</div>
        <div class="shelf shelf-bottom s11" data-shelf-id="11">11</div>
        <div class="shelf shelf-bottom s12" data-shelf-id="12">12</div>
        <div class="shelf shelf-bottom s13" data-shelf-id="13">13</div>
        <div class="shelf shelf-bottom s14" data-shelf-id="14">14</div>
        <div class="shelf shelf-bottom s15" data-shelf-id="15">15</div>
        <div class="shelf shelf-bottom s16" data-shelf-id="16">16</div>

      </div>
    </div>
  </section>

  <!-- ------------------------------------- -->
  <!--      PANNELLO: CERCA + CONTENUTO     -->
  <!-- ------------------------------------- -->
  <section class="card panel">

    <div class="search-box">
      <label for="searchInput">Cerca articolo (es: turbine, cavi, trasformatori‚Ä¶)</label>
      <input type="text" id="searchInput" placeholder="Digita il nome‚Ä¶">
    </div>

    <div class="search-results" id="searchResults">
      <div>Scrivi qualcosa per cercare negli scaffali‚Ä¶</div>
    </div>

    <h2 id="shelfTitle">Nessuno scaffale selezionato</h2>
    <small id="shelfSubtitle">Clicca uno scaffale nella mappa sopra.</small>

    <ul id="shelfItems"></ul>
    <div class="empty" id="emptyMessage" style="display:none;">Nessun articolo su questo scaffale.</div>

    <!-- ------------------------------------- -->
    <!--      GESTIONE INVENTARIO (ADMIN)       -->
    <!-- ------------------------------------- -->
    <div class="admin-box">
      <h3>Gestione scaffali</h3>

      <form id="addForm">
        <div class="admin-grid">
          <select id="addShelf"></select>
          <input type="text" id="addName" placeholder="Nome articolo">
          <input type="number" id="addQty" min="1" value="1">
        </div>

        <div class="admin-grid-note">
          <input type="text" id="addNote" placeholder="Note (opzionale)">
        </div>

        <button type="submit" class="btn-add">Aggiungi / aggiorna articolo</button>
      </form>

      <small>
        Per spostare un articolo: aggiungilo nel nuovo scaffale, poi rimuovilo dal vecchio.<br>
        I dati sono salvati localmente nel browser.
      </small>
    </div>
  </section>
</main>

<script>
/* ------------------------------------------------------------------------------------ */
/*                         DEFAULT INVENTORY CON LE CATEGORIE                           */
/* ------------------------------------------------------------------------------------ */
const defaultInventory = {
  "1": [
    { name: "Manovre", qty: 1, note: "(categoria)" },
    { name: "Tubazioni", qty: 1, note: "(categoria)" },
    { name: "Giunti idraulici", qty: 1, note: "(categoria)" }
  ],
  "2": [
    { name: "Manovre", qty: 1, note: "(categoria)" },
    { name: "Cuscinetti", qty: 1, note: "(categoria)" },
    { name: "Accessori idraulici", qty: 1, note: "(categoria)" }
  ],
  "3": [
    { name: "Turbine", qty: 1, note: "(categoria)" }
  ],
  "4": [
    { name: "Molle distributore", qty: 1, note: "(categoria)" },
    { name: "Giranti", qty: 1, note: "(categoria)" },
    { name: "Idraulica", qty: 1, note: "(categoria)" }
  ],
  "5": [
    { name: "Cantieristica", qty: 1, note: "(categoria)" }
  ],
  "6": [
    { name: "Cantieristica", qty: 1, note: "(categoria)" },
    { name: "Cartelli", qty: 1, note: "(categoria)" }
  ],
  "7": [
    { name: "Taniche", qty: 1, note: "(categoria)" },
    { name: "Cantieristica", qty: 1, note: "(categoria)" }
  ],
  "8": [
    { name: "Pannoloni e assorbenti d'olio", qty: 1, note: "(categoria)" },
    { name: "Stracci assorbenti d'olio", qty: 1, note: "(categoria)" }
  ],
  "9": [
    { name: "Motori elettrici", qty: 1, note: "(categoria)" }
  ],
  "10": [
    { name: "Manovre elettriche", qty: 1, note: "(categoria)" },
    { name: "Motori", qty: 1, note: "(categoria)" }
  ],
  "11": [
    { name: "Trasformatori elettrici", qty: 1, note: "(categoria)" },
    { name: "Apparecchiature elettriche", qty: 1, note: "(categoria)" }
  ],
  "12": [
    { name: "Sbobinatrici", qty: 1, note: "(categoria)" },
    { name: "Quadri elettrici", qty: 1, note: "(categoria)" }
  ],
  "13": [
    { name: "Apparecchiature elettriche (vario tipo)", qty: 1, note: "(categoria)" }
  ],
  "14": [
    { name: "Cavi elettrici", qty: 1, note: "(categoria)" }
  ],
  "15": [
    { name: "Cavi elettrici", qty: 1, note: "(categoria)" }
  ],
  "16": [
    { name: "Cavi elettrici", qty: 1, note: "(categoria)" }
  ]
};

const STORAGE_KEY = "warehouseInventory_1_16_v2";

function loadInventory() {
  const saved = localStorage.getItem(STORAGE_KEY);
  if (saved) {
    try { return JSON.parse(saved); } catch (e) {}
  }
  return structuredClone(defaultInventory);
}

function saveInventory() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(inventory));
}

let inventory = loadInventory();

/* -------------------------------------------------------------- */
/*                    SELETTORI E FUNZIONI UI                     */
/* -------------------------------------------------------------- */

const shelfElements = document.querySelectorAll(".shelf");
const shelfTitle = document.getElementById("shelfTitle");
const shelfSubtitle = document.getElementById("shelfSubtitle");
const shelfItems = document.getElementById("shelfItems");
const emptyMessage = document.getElementById("emptyMessage");
const searchInput = document.getElementById("searchInput");
const searchResults = document.getElementById("searchResults");

const addForm = document.getElementById("addForm");
const addShelfSelect = document.getElementById("addShelf");
const addNameInput = document.getElementById("addName");
const addQtyInput = document.getElementById("addQty");
const addNoteInput = document.getElementById("addNote");

let currentShelfId = null;

function populateShelfSelect() {
  addShelfSelect.innerHTML = "";
  shelfElements.forEach(el => {
    const id = el.dataset.shelfId;
    const opt = document.createElement("option");
    opt.value = id;
    opt.textContent = "Scaffale " + id;
    addShelfSelect.appendChild(opt);
  });
}
populateShelfSelect();

/* -------------------------------------------------------------- */
/*                       MOSTRA CONTENUTO                         */
/* -------------------------------------------------------------- */

function showShelfContents(id) {
  currentShelfId = id;

  shelfElements.forEach(el =>
    el.classList.toggle("active", el.dataset.shelfId === id)
  );

  shelfTitle.textContent = "Contenuto scaffale " + id;

  const items = inventory[id] || [];
  shelfItems.innerHTML = "";

  if (!items.length) {
    emptyMessage.style.display = "block";
    return;
  } else emptyMessage.style.display = "none";

  items.forEach((item, index) => {
    const li = document.createElement("li");

    const main = document.createElement("div");
    main.className = "item-main";
    main.innerHTML = `
      ${item.name}
      <span class="qty">x${item.qty}</span>
      ${item.note ? `<small>${item.note}</small>` : ""}
    `;

    const btn = document.createElement("button");
    btn.textContent = "Rimuovi";
    btn.className = "btn-small";
    btn.dataset.index = index;
    btn.dataset.shelfId = id;

    li.appendChild(main);
    li.appendChild(btn);
    shelfItems.appendChild(li);
  });
}

/* -------------------------------------------------------------- */
/*                            RICERCA                              */
/* -------------------------------------------------------------- */

function searchItems(term) {
  const query = term.trim().toLowerCase();
  searchResults.innerHTML = "";
  shelfElements.forEach(el => el.classList.remove("highlight"));

  if (!query) {
    searchResults.innerHTML = "<div>Scrivi qualcosa per cercare negli scaffali‚Ä¶</div>";
    return;
  }

  const results = [];

  for (const shelfId in inventory) {
    (inventory[shelfId] || []).forEach(item => {
      if (item.name.toLowerCase().includes(query))
        results.push({ shelfId, item });
    });
  }

  if (!results.length) {
    searchResults.innerHTML = "<div>Nessun risultato trovato.</div>";
    return;
  }

  results.forEach(r => {
    const el = document.querySelector(`.shelf[data-shelf-id="${r.shelfId}"]`);
    if (el) el.classList.add("highlight");
  });

  results.forEach(r => {
    const div = document.createElement("div");
    div.innerHTML = `<strong>${r.item.name}</strong> ‚Äî scaffale <strong>${r.shelfId}</strong>`;
    div.style.cursor = "pointer";
    div.onclick = () => showShelfContents(r.shelfId);
    searchResults.appendChild(div);
  });
}

/* -------------------------------------------------------------- */
/*                         EVENTI CLICK                            */
/* -------------------------------------------------------------- */

shelfElements.forEach(el => {
  el.addEventListener("click", () => {
    const id = el.dataset.shelfId;
    showShelfContents(id);
    addShelfSelect.value = id;
  });
});

searchInput.addEventListener("input", e => {
  searchItems(e.target.value);
});

/* -------------------------------------------------------------- */
/*                       AGGIUNTA / UPDATE                         */
/* -------------------------------------------------------------- */

addForm.addEventListener("submit", e => {
  e.preventDefault();

  const id = addShelfSelect.value;
  const name = addNameInput.value.trim();
  const qty = parseInt(addQtyInput.value, 10);
  const note = addNoteInput.value.trim();

  if (!name || qty < 1) {
    alert("Inserisci un nome articolo e una quantit√† valida.");
    return;
  }

  if (!inventory[id]) inventory[id] = [];

  const existing = inventory[id].find(i => i.name.toLowerCase() === name.toLowerCase());

  if (existing) {
    existing.qty += qty;
    if (note) existing.note = note;
  } else {
    inventory[id].push({ name, qty, note });
  }

  saveInventory();
  if (currentShelfId === id) showShelfContents(id);
  searchItems(searchInput.value);

  addNameInput.value = "";
  addQtyInput.value = 1;
  addNoteInput.value = "";
});

/* -------------------------------------------------------------- */
/*                         RIMOZIONE ITEM                          */
/* -------------------------------------------------------------- */

shelfItems.addEventListener("click", e => {
  if (!e.target.classList.contains("btn-small")) return;

  const id = e.target.dataset.shelfId;
  const index = parseInt(e.target.dataset.index);

  const item = inventory[id][index];
  if (!confirm(`Rimuovere "${item.name}" dallo scaffale ${id}?`)) return;

  inventory[id].splice(index, 1);
  saveInventory();
  showShelfContents(id);
  searchItems(searchInput.value);
});
</script>

</body>
</html>